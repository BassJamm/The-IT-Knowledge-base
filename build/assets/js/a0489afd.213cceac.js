"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2242],{3905:(e,t,o)=>{o.d(t,{Zo:()=>h,kt:()=>g});var n=o(7294);function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,i=function(e,t){if(null==e)return{};var o,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(i[o]=e[o]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},h=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var o=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),d=c(o),p=i,g=d["".concat(s,".").concat(p)]||d[p]||u[p]||r;return o?n.createElement(g,a(a({ref:t},h),{},{components:o})):n.createElement(g,a({ref:t},h))}));function g(e,t){var o=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=o.length,a=new Array(r);a[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:i,a[1]=l;for(var c=2;c<r;c++)a[c]=o[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}p.displayName="MDXCreateElement"},8615:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var n=o(7462),i=(o(7294),o(3905));const r={title:"Code Challenge - 001 - File Backup Utility",description:"Build a basic script that will copy data from source to destination.",slug:"Code-Challenge-001",date:"2023-07-05T12:00",authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],tags:["Code-Challenge"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},a=void 0,l={permalink:"/blog/Code-Challenge-001",source:"@site/blog/2023/05-07-Code-Challenge-001-File-Backup.md",title:"Code Challenge - 001 - File Backup Utility",description:"Build a basic script that will copy data from source to destination.",date:"2023-07-05T12:00:00.000Z",formattedDate:"July 5, 2023",tags:[{label:"Code-Challenge",permalink:"/blog/tags/code-challenge"}],readingTime:4.876666666666667,hasTruncateMarker:!0,authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],frontMatter:{title:"Code Challenge - 001 - File Backup Utility",description:"Build a basic script that will copy data from source to destination.",slug:"Code-Challenge-001",date:"2023-07-05T12:00",authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],tags:["Code-Challenge"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},nextItem:{title:"Welcome Docusaurus v2",permalink:"/blog/welcome-docusaurus-v2"}},s={authorsImageUrls:[void 0]},c=[{value:"The challenge",id:"the-challenge",level:2},{value:"My solution",id:"my-solution",level:2},{value:"Using the <code>Copy-Item</code> command",id:"using-the-copy-item-command",level:2},{value:"Solving the \u201cthis already exists\u201d error",id:"solving-the-this-already-exists-error",level:3},{value:"Outputting something to console",id:"outputting-something-to-console",level:3},{value:"Error logging",id:"error-logging",level:3},{value:"Bonus: Creating a log file",id:"bonus-creating-a-log-file",level:3},{value:"Full script",id:"full-script",level:2}],h={toc:c},d="wrapper";function u(e){let{components:t,...o}=e;return(0,i.kt)(d,(0,n.Z)({},h,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The first of many code challenges that I'll be tackling, these will be as much a learning experience for me as they may help you."),(0,i.kt)("p",null,"In the world of software development, coding challenges have emerged as an effective way to sharpen programming skills, test problem-solving abilities, and demonstrate expertise. I however, am not in the software development world, I am in the realm of Infrastructure design and maintenance; where I am hoping to apply the same type of challenges to further my knowledge of PowerShell, Bicep & perhaps one or two more along the way."),(0,i.kt)("h2",{id:"the-challenge"},"The challenge"),(0,i.kt)("p",null,"Create a PowerShell script that backs up a specified directory to another location. The script should recursively copy all files and subdirectories while preserving the directory structure. It can include options for excluding certain file types or directories from the backup."),(0,i.kt)("p",null,"This seems rather arbitray to script this but, I got an AI to generate these challenges so, I'll dig in none the less."),(0,i.kt)("h2",{id:"my-solution"},"My solution"),(0,i.kt)("admonition",{title:"Before anyone rolls their eyes at the below.",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"This is just a learning expereince, I am aware of the other commands\\applications that can do this (RoboCopy for examepl).")),(0,i.kt)("h2",{id:"using-the-copy-item-command"},"Using the ",(0,i.kt)("inlineCode",{parentName:"h2"},"Copy-Item")," command"),(0,i.kt)("p",null,"This is the very basic first attempt at solving this challenge. Using ",(0,i.kt)("inlineCode",{parentName:"p"},"Read-Host")," we take in a user input stored as a string, we then substitute the variables ",(0,i.kt)("inlineCode",{parentName:"p"},"$backupdirectory")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"$destinationDirectory")," in place of the file paths."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-powershell",metastring:"showLineNumbers",showLineNumbers:!0},'# Takes user input for source directory.\n$sourceDirectory = Read-Host -Prompt "Enter source directory"\n\n# Takes user input for the destination directory.        \n$destinationdirectory = Read-Host -Prompt "Enter destination directory"\n\n# Copy-Item command does the copying.\nCopy-Item -Path $sourceDirectory -Destination $destinationdirectory -Recurse\n')),(0,i.kt)("p",null,"This would do the job but, there\u2019s a few issues to note with this: -"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"It\u2019ll error if you run it more than once, since the directory will already exist in the destination location."),(0,i.kt)("li",{parentName:"ol"},"There\u2019s no output to the console to comfort a nervy user that something is happening."),(0,i.kt)("li",{parentName:"ol"},"There\u2019s no checks going on to confirm what exists already & no log file to help a techy see what is going on.")),(0,i.kt)("p",null,"We\u2019ll deal with them in order."),(0,i.kt)("h3",{id:"solving-the-this-already-exists-error"},"Solving the \u201cthis already exists\u201d error"),(0,i.kt)("p",null,"There\u2019s two options that can be easily done to solve this, either use the ",(0,i.kt)("inlineCode",{parentName:"p"},"-force")," switch, which\u2019ll just overwrite the destination location, or you can differentiate the destination data from the source by changing the name of the top level folder for example, adding the date and time to the folder or re-naming it to something else; this is what we\u2019ll do this time."),(0,i.kt)("p",null,"In the below snippet we now have the ",(0,i.kt)("inlineCode",{parentName:"p"},"$dateNow")," variable, which fetches the date and time of when the script runs. The ",(0,i.kt)("inlineCode",{parentName:"p"},".ToString('dd-MM-yyyy_hh-mm-ss')")," part converts the object to a string, so that we can add it to the new folder we\u2019ll create as part of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Copy-Item")," command."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"(Get-Date)")," command is in brackets so PowerShell knows to run this part first before the section just after it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-powershell",metastring:"showLineNumbers",showLineNumbers:!0},"# Copy-Item command does the copying.\n# The destination location is set using the $destinationdirectory variable, then appending the text DataBackup.\n# It then appends the date using the $dateNow variable. It's encased in brackets so that he variable is substitued into the string.\n# The recurse switch includes all subdirectories of the specified source location.\nCopy-Item -Path $sourceDirectory -Destination $destinationdirectory\\DataBackup-$($dateNow) -Recurse\n")),(0,i.kt)("h3",{id:"outputting-something-to-console"},"Outputting something to console"),(0,i.kt)("p",null,"This option can be up for debate, some would say that you don\u2019t need an output just a comprehensive log file but, I like a bit of an info dump to the console as long as it is relevant."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Be careful when using Write-Host it\u2019s not processed as part of the Pipeline within PowerShell, so it can be printed to console before the previous command has finished running\\computing. Use it sparingly.")),(0,i.kt)("p",null,"To dump out some simple updates to the console, I have added some Write-Host commands, this literally writes whatever text you put after it in quotes to console and you can change it\u2019s colour using the -foregroundcolor swtich."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-powershell",metastring:"showLineNumbers",showLineNumbers:!0},'Write-Host "Copy $($sourceDirectory) data to $($destinationdirectory), into the folder named DataBackup-$($dateNow)." -ForegroundColor Yellow\nStart-Sleep 1\n\nWrite-Host "Beginning Copy job." -ForegroundColor Yellow\nStart-Sleep 1 # This is here to add some "nice" timings to the script.\n\nCopy-Item -Path $sourceDirectory -Destination $destinationdirectory\\DataBackup-$($dateNow) -Recurse\n\nStart-Sleep 1 # This one is here to make sure the comamnd above has finished before the write-host command executes.\nWrite-Host "Copy Job Completed." -ForegroundColor Green\n')),(0,i.kt)("h3",{id:"error-logging"},"Error logging"),(0,i.kt)("p",null,"This can be tricky for larger scripts and there\u2019s multiple ways of handling errors in scripts, I have gone for the simplest option (I think!). Whilst I really don\u2019t think this is best practice or going to win any favor with a PowerShell Guru (myself not included, I am still learning), it is simple to get your head around."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Try {} Catch{}")," blocks are great for trying something and then catching the error relating to that command, by default though, I would suggest doing only one thing in in the whole try\\catch segment, trying to do too much in one block negates the benefit of using it!"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},'If you should want to test the Try Catch block, simple add "NonsenseString" to your try segment, it\'ll always produce an error.')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-powershell",metastring:"showLineNumbers",showLineNumbers:!0},"# Try Catch blocks are great for trying a thing and catching an error.\ntry {\n    # Copy-Item -Path $sourceDirectory -Destination $destinationdirectory\\DataBackup-$($dateNow) -Recurse\n    \n}\ncatch {\n    # Write-Warning $Error[0] - This will write only the error message to console if you don't want the whole error.\n    $_ # This wil dump the whole error to consol for you.\n}\n")),(0,i.kt)("h3",{id:"bonus-creating-a-log-file"},"Bonus: Creating a log file"),(0,i.kt)("p",null,"As a bit extra, here\u2019s a function that creates a log file and how you can write to it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-powershell",metastring:"showLineNumbers",showLineNumbers:!0},'$date = Get-Date -Format dd-mm-yyyy\n$logFileLocation = "C:\\Temp\\"\n\n<# Create the log file. #>\n\ntry {\n    <# Try the following. #>\n    function WriteToLogFile ($message) {\n        Add-Content $logFileLocation\\LogFile_$date.log -Value $message\n    }\n    if (Test-Path $logFileLocation\\LogFile_$date.log) {\n        Write-Host \'Log file already exists, deleting and re-creating.\'\n        Start-Sleep 2\n        Remove-Item $logFileLocation\\LogFile_$date.log\n    }\n    WriteToLogFile "$(Get-Date) - Log File created."\n}\ncatch {\n    <# Collect and report any errors. #>\n    Write-Host "Failed to create log file at the following location:"$logFileLocation -ForegroundColor Red", continuing without logging."\n    Write-Host $_ -ForegroundColor Red\n    WriteToLogFile "$(Get-Date) - $($_)"\n    throw  \'Script terminated.\' \n}\n')),(0,i.kt)("p",null,"To use this function, change the ",(0,i.kt)("inlineCode",{parentName:"p"},"$logFileLocation")," variable to the desired location, maybe use the destination location variable."),(0,i.kt)("p",null,"You can then use the command ",(0,i.kt)("inlineCode",{parentName:"p"},'WriteToLogFile -Message "Add text here"')," anything in-between the quotes will appended to the log file, check out the full solution below to see what I mean."),(0,i.kt)("h2",{id:"full-script"},"Full script"),(0,i.kt)("p",null,"As I mentioned at the top, the best method for doing large copy jobs is ",(0,i.kt)("inlineCode",{parentName:"p"},"RoboCopy"),", you can find more on that ",(0,i.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/robocopy"},"here"),". Otherwise for this learning exercise, you review, steal and re-use whatever it below for your own needs."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-powershell",metastring:"showLineNumbers",showLineNumbers:!0},'$date = Get-Date -Format dd-mm-yyyy\n$logFileLocation = "C:\\Temp\\"\n\n<# Create the log file. #>\n\ntry {\n    <# Try the following. #>\n    function WriteToLogFile ($message) {\n        Add-Content $logFileLocation\\LogFile_$date.log -Value $message\n    }\n    if (Test-Path $logFileLocation\\LogFile_$date.log) {\n        Write-Host \'Log file already exists, deleting and re-creating.\'\n        Start-Sleep 2\n        Remove-Item $logFileLocation\\LogFile_$date.log\n    }\n    WriteToLogFile "$(Get-Date) - Log File created."\n}\ncatch {\n    <# Collect and report any errors. #>\n    Write-Host "Failed to create log file at the following location:"$logFileLocation -ForegroundColor Red", continuing without logging."\n    Write-Host $_ -ForegroundColor Red\n    WriteToLogFile "$(Get-Date) - $($_)"\n    throw  \'Script terminated.\' \n}\n\n# Takes user input for source directory.\n$sourceDirectory = Read-Host -Prompt "Enter source directory"\nWriteToLogFile -message "User inputed $($sourceDirectory) as the source."\n\n# Takes user input for the destination directory.        \n$destinationdirectory = Read-Host -Prompt "Enter destination directory"\nWriteToLogFile -message "User entered ($destinationdirectory) as the destination."\n\n# Gets the date and time in seconds when the script is ran.\n$dateNow = (Get-Date).ToString(\'dd-MM-yyyy_hh-mm-ss\')\n\nWrite-Host "Copy $($sourceDirectory) data to $($destinationdirectory), into the folder named DataBackup-$($dateNow)." -ForegroundColor Yellow\nStart-Sleep 1\n\n\nWrite-Host "Beginning Copy job." -ForegroundColor Yellow\nWriteToLogFile -message "Copy job starting."\nStart-Sleep 1 # This is here to add some "nice" timings to the script.\n\n# Copy-Item command does the copying.\n# The destination location is set using the $destinationdirectory variable, then appending the text DataBackup.\n# It then appends the date using the $dateNow variable. It\'s encased in brackets so that he variable is substitued into the string.\n# The recurse switch includes all subdirectories of the specified source location.\ntry {\n    Copy-Item -Path $sourceDirectory -Destination $destinationdirectory\\DataBackup-$($dateNow) -Recurse\n    WriteToLogFile -message "Copy job running."\n}\ncatch {\n    Write-Warning $Error[0]\n    WriteToLogFile -message "$($Error[0])"\n}\n\nStart-Sleep 1 # This one is here to make sure the comamnd above has finished before the write-host command executes.\nWrite-Host "Copy Job Completed." -ForegroundColor Green\nWriteToLogFile -message "Copy Job Completed."\n')))}u.isMDXComponent=!0}}]);