"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3161],{3905:(e,t,o)=>{o.d(t,{Zo:()=>c,kt:()=>k});var r=o(7294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var u=r.createContext({}),s=function(e){var t=r.useContext(u),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},c=function(e){var t=s(e.components);return r.createElement(u.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,i=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(o),g=n,k=p["".concat(u,".").concat(g)]||p[g]||m[g]||i;return o?r.createElement(k,a(a({ref:t},c),{},{components:o})):r.createElement(k,a({ref:t},c))}));function k(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=o.length,a=new Array(i);a[0]=g;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l[p]="string"==typeof e?e:n,a[1]=l;for(var s=2;s<i;s++)a[s]=o[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,o)}g.displayName="MDXCreateElement"},3973:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>u,contentTitle:()=>a,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var r=o(7462),n=(o(7294),o(3905));const i={title:"Backing up Resources in Azure",description:"Pointers for setting up Azure Backup.",slug:"Backing-up-resources-with-AzBackup",date:"2023-10-28T13:00",authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],tags:["hello","docusaurus-v2"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},a=void 0,l={permalink:"/blog/Backing-up-resources-with-AzBackup",source:"@site/blog/2023-10-28-Azure-Backup/Backing-up-VMs.md",title:"Backing up Resources in Azure",description:"Pointers for setting up Azure Backup.",date:"2023-10-28T13:00:00.000Z",formattedDate:"October 28, 2023",tags:[{label:"hello",permalink:"/blog/tags/hello"},{label:"docusaurus-v2",permalink:"/blog/tags/docusaurus-v-2"}],readingTime:1.6,hasTruncateMarker:!0,authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],frontMatter:{title:"Backing up Resources in Azure",description:"Pointers for setting up Azure Backup.",slug:"Backing-up-resources-with-AzBackup",date:"2023-10-28T13:00",authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],tags:["hello","docusaurus-v2"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},nextItem:{title:"Automate Scripts in Azure",permalink:"/blog/Automate-scripts-in-Azure"}},u={authorsImageUrls:[void 0]},s=[{value:"Before you dive in",id:"before-you-dive-in",level:2},{value:"The Run down",id:"the-run-down",level:2},{value:"Creating the Resources",id:"creating-the-resources",level:3},{value:"Configure Backup Policy",id:"configure-backup-policy",level:3},{value:"Configure Alerting",id:"configure-alerting",level:3},{value:"Configure Diagnostic log collection",id:"configure-diagnostic-log-collection",level:3}],c={toc:s},p="wrapper";function m(e){let{components:t,...o}=e;return(0,n.kt)(p,(0,r.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"An outline of setting up Azure Backup and the decisions around doing so that I learn along the way."),(0,n.kt)("p",null,"Azure Backup is a Microsoft Azure service that provides reliable and cost-effective data protection for your critical workloads. It enables you to securely back up and recover data from on-premises systems and Azure virtual machines, offering peace of mind for safeguarding your business-critical information."),(0,n.kt)("admonition",{title:"It might not be the best way!",type:"note"},(0,n.kt)("p",{parentName:"admonition"},"This document is for setting backup policeis for Virutal Machines only. If you need to backup other resources, go to section 1.2, step 4 and select a differnet resource.")),(0,n.kt)("h2",{id:"before-you-dive-in"},"Before you dive in"),(0,n.kt)("p",null,"Some decisions to consider before clicking about and winging it:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Policy Naming Conventions."),(0,n.kt)("li",{parentName:"ul"},"How are you going to group your resources? (Don't care or different policies per resource type?)"),(0,n.kt)("li",{parentName:"ul"},"Backup Schedules."),(0,n.kt)("li",{parentName:"ul"},"Alerting.")),(0,n.kt)("p",null,"You'll need to setup the following:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"A resource Group."),(0,n.kt)("li",{parentName:"ul"},"Service Recovery Services Vault."),(0,n.kt)("li",{parentName:"ul"},"Log Analytics Workspace.")),(0,n.kt)("h2",{id:"the-run-down"},"The Run down"),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Use whatever naming conention fits in with what\u2019s being used already, I am just suggesting something here.")),(0,n.kt)("p",null,"Below sections outline my steps for setting up Azure Backup."),(0,n.kt)("h3",{id:"creating-the-resources"},"Creating the Resources"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Create the resource group, for example, ",(0,n.kt)("inlineCode",{parentName:"li"},"rg-customername-region-prod/dev-backups-01"),"."),(0,n.kt)("li",{parentName:"ol"},"Create a recovery services vault to store the backups (GRS is the preferred option, LRS for lowest cost), for example, ",(0,n.kt)("inlineCode",{parentName:"li"},"rsv-customername-region-prod/dev-backup-01"),"."),(0,n.kt)("li",{parentName:"ol"},"Create a log analytics workspace or reuse another one, for example, ",(0,n.kt)("inlineCode",{parentName:"li"},"la-customername-region-prod/dev-backup-01"),".")),(0,n.kt)("h3",{id:"configure-backup-policy"},"Configure Backup Policy"),(0,n.kt)("p",null,"Configure the backup policy in-line with whatever standard is being used already, my suggestions are below."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"In the Azure portal, select a Recovery Services vault to back up the VM."),(0,n.kt)("li",{parentName:"ol"},"Under Backup, select Backup Policies."),(0,n.kt)("li",{parentName:"ol"},"Click +Add."),(0,n.kt)("li",{parentName:"ol"},"On Select policy type, select Azure Virtual Machine."),(0,n.kt)("li",{parentName:"ol"},"On Create policy, perform the following actions:"),(0,n.kt)("li",{parentName:"ol"},"Policy sub type: Standard"),(0,n.kt)("li",{parentName:"ol"},"Suggested Name format: ",(0,n.kt)("inlineCode",{parentName:"li"},"Bkup-policy-time of day-policy type")," (example name: bkup-policy-nightly-std).")),(0,n.kt)("h3",{id:"configure-alerting"},"Configure Alerting"),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"Note that this method is using the old backup alerting method, this is being replaced by Azure Monitor.")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/backup/backup-azure-monitoring-built-in-monitor?tabs=recovery-services-vaults#turning-on-azure-monitor-alerts-for-job-failure-scenarios"},"Microsoft Link for more information")),(0,n.kt)("p",null,"Configure diagnostic logs to be sent from Azure Backup to the Log Anlytics workspace above."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"From the Recovery services vault just setup."),(0,n.kt)("li",{parentName:"ol"},"Click on Backup Alerts, under the Monitoring section."),(0,n.kt)("li",{parentName:"ol"},"Click Configure Notifications."),(0,n.kt)("li",{parentName:"ol"},"Enable Notifications: Yes"),(0,n.kt)("li",{parentName:"ol"},"Recipients(Email): ",(0,n.kt)("a",{parentName:"li",href:"mailto:monitoring@DomainName.com"},"monitoring@DomainName.com")),(0,n.kt)("li",{parentName:"ol"},"Notify: Hourly digest"),(0,n.kt)("li",{parentName:"ol"},"Severity: Critical & Warning")),(0,n.kt)("h3",{id:"configure-diagnostic-log-collection"},"Configure Diagnostic log collection"),(0,n.kt)("p",null,"Configure diagnostic logs to be sent from Azure Backup to the Log Anlytics workspace above."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Navigate to Diagnostic settings under Monitoring."),(0,n.kt)("li",{parentName:"ol"},"Click Add Diagnostic Settings."),(0,n.kt)("li",{parentName:"ol"},"Name your diagnostic setting, something informational, for example, \u201cAzBkup-Diagnostics\u201d, suggestion, Backup Report Data."),(0,n.kt)("li",{parentName:"ol"},"Select Send to Log Analytics Workspace."),(0,n.kt)("li",{parentName:"ol"},"Add a workspace and don\u2019t touch any other settings."),(0,n.kt)("li",{parentName:"ol"},"Hit Save.")),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"Make sure to run the initial backup job from the Azure Backup Dashboard.")))}m.isMDXComponent=!0}}]);