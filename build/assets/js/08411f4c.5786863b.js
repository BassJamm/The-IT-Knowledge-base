"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[512],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>f});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},l=Object.keys(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=o.createContext({}),p=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},s=function(e){var t=p(e.components);return o.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,c=e.parentName,s=r(e,["components","mdxType","originalType","parentName"]),u=p(n),m=i,f=u["".concat(c,".").concat(m)]||u[m]||d[m]||l;return n?o.createElement(f,a(a({ref:t},s),{},{components:n})):o.createElement(f,a({ref:t},s))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,a=new Array(l);a[0]=m;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r[u]="string"==typeof e?e:i,a[1]=r;for(var p=2;p<l;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9015:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>p});var o=n(7462),i=(n(7294),n(3905));const l={draft:!1,id:"Uninstall McAfee",title:"Uninstall McAfee",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Destroy McAfee",sidebar_position:1,toc_max_heading_level:4,pagination_label:"Uninstall McAfee",tags:["Intune","Application","Script"],custom_edit_url:"https://github.com/facebook/docusaurus/edit/main/docs/api-doc-markdown.md",description:"Documents how to deploy McAfee."},a=void 0,r={unversionedId:"Intune/Application-Deployments/Uninstall McAfee",id:"Intune/Application-Deployments/Uninstall McAfee",title:"Uninstall McAfee",description:"Documents how to deploy McAfee.",source:"@site/docs/Intune/Application-Deployments/Destroy-McAfee.md",sourceDirName:"Intune/Application-Deployments",slug:"/Intune/Application-Deployments/Uninstall McAfee",permalink:"/docs/Intune/Application-Deployments/Uninstall McAfee",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/main/docs/api-doc-markdown.md",tags:[{label:"Intune",permalink:"/docs/tags/intune"},{label:"Application",permalink:"/docs/tags/application"},{label:"Script",permalink:"/docs/tags/script"}],version:"current",sidebarPosition:1,frontMatter:{draft:!1,id:"Uninstall McAfee",title:"Uninstall McAfee",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Destroy McAfee",sidebar_position:1,toc_max_heading_level:4,pagination_label:"Uninstall McAfee",tags:["Intune","Application","Script"],custom_edit_url:"https://github.com/facebook/docusaurus/edit/main/docs/api-doc-markdown.md",description:"Documents how to deploy McAfee."},sidebar:"tutorialSidebar",previous:{title:"App Deployments",permalink:"/docs/category/app-deployments"},next:{title:"EveryOne Print",permalink:"/docs/Intune/Application-Deployments/EveryOne Print"}},c={},p=[{value:"Deployment Guidance",id:"deployment-guidance",level:2},{value:"Download the MCPR Tool",id:"download-the-mcpr-tool",level:3},{value:"Script Creation",id:"script-creation",level:3},{value:"Create your IntuneWin File",id:"create-your-intunewin-file",level:3},{value:"Intune Settings: Win32 App Deployment",id:"intune-settings-win32-app-deployment",level:2},{value:"Deployment Script",id:"deployment-script",level:3}],s={toc:p},u="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,o.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"deployment-guidance"},"Deployment Guidance"),(0,i.kt)("admonition",{title:"Local Folder Structure",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"I would suggest setting up the following folder struture on your local machine first."),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},"Create ",(0,i.kt)("inlineCode",{parentName:"li"},"C:\\Software\\Intune-Apps\\McAfee"),"."),(0,i.kt)("li",{parentName:"ol"},"Inside McAfee, place your exe and install script."),(0,i.kt)("li",{parentName:"ol"},"Create an output folder here like so, ",(0,i.kt)("inlineCode",{parentName:"li"},"C:\\Software\\Intune-Apps\\Output")))),(0,i.kt)("h3",{id:"download-the-mcpr-tool"},"Download the MCPR Tool"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Download Link here, ",(0,i.kt)("a",{parentName:"li",href:"https://download.mcafee.com/molbin/iss-loc/SupportTools/MCPR/MCPR.exe"},"MCPRTool"),"."),(0,i.kt)("li",{parentName:"ol"},"Run the Tool on your endpoint."),(0,i.kt)("li",{parentName:"ol"},"Find the Temp Folder located here: ",(0,i.kt)("inlineCode",{parentName:"li"},"C:\\Users\\$env:UserName\\Appdata\\Local\\Temp"),"."),(0,i.kt)("li",{parentName:"ol"},"In here will be a folder containing an exe file called ",(0,i.kt)("inlineCode",{parentName:"li"},"MCCleanup.exe"),"."),(0,i.kt)("li",{parentName:"ol"},"Find this and copy the whole folder it is in and all contents into ",(0,i.kt)("inlineCode",{parentName:"li"},"C:\\Software\\Intune-Apps\\McAfee\\MCPR-Tool"))),(0,i.kt)("h3",{id:"script-creation"},"Script Creation"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Navigate to ",(0,i.kt)("inlineCode",{parentName:"li"},"C:\\Software\\Intune-Apps\\McAfee"),"."),(0,i.kt)("li",{parentName:"ol"},"Create a new script called, ",(0,i.kt)("inlineCode",{parentName:"li"},"Destroy-McAfee.ps1"),"."),(0,i.kt)("li",{parentName:"ol"},"In the file place the script noted in the section below.")),(0,i.kt)("p",null,"In the location, ",(0,i.kt)("inlineCode",{parentName:"p"},"C:\\Software\\Intune-Apps\\McAfee"),", you should have the below:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MCPR-Tool")," folder, containing the MCPR Tool (",(0,i.kt)("inlineCode",{parentName:"li"},"MCCleanup.exe"),") and all other files\\folders."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Destroy-McAfee.ps1")," Script.")),(0,i.kt)("h3",{id:"create-your-intunewin-file"},"Create your IntuneWin File"),(0,i.kt)("p",null,"Package the exe and the script into an IntuneWin File using the Microsoft Win32 Content Prep Tool; command refernce below."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Open PowerShell as an Admin."),(0,i.kt)("li",{parentName:"ol"},"Navigate to the location of the Win32 Content Prep Tool."),(0,i.kt)("li",{parentName:"ol"},"Run this command, ",(0,i.kt)("inlineCode",{parentName:"li"},"Content-prep-tool-name -c C:\\Software\\Intune-Apps\\McAfee -s C:\\Software\\Intune-Apps\\McAfee\\Destroy-McAfee.ps1 -o C:\\Software\\Intune-Apps\\Output"))),(0,i.kt)("h2",{id:"intune-settings-win32-app-deployment"},"Intune Settings: Win32 App Deployment"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Select a Win32 App Deployment."),(0,i.kt)("li",{parentName:"ol"},"Make sure to set the detection option to ",(0,i.kt)("inlineCode",{parentName:"li"},"File")," and point it at the text file outpt in the script, ",(0,i.kt)("inlineCode",{parentName:"li"},"C:\\ProgramData\\Output\\McAfee\\McAfee-Script-Ran-Successfully-McAfee-Not-Found.txt"),".")),(0,i.kt)("h3",{id:"deployment-script"},"Deployment Script"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-powershell",metastring:"showLineNumbers",showLineNumbers:!0},'# Create a log file.\n$logFileLocation = "C:\\ProgramData\\Output\\McAfee"\n$dateOfRun = (Get-Date).ToString("yyyy-MM-dd_hh-ss")\nNew-Item -Path $logFileLocation -ItemType Directory -ErrorAction SilentlyContinue\n\nfunction WriteToLogFile($message) {\n    Add-Content "$logFileLocation\\McAfee_Removal_LogFile_$($dateOfRun).log" -Value "$(Get-Date) - $($message)"\n}\n\nWriteToLogFile "Log File Created."\nWriteToLogFile "Script begins now."\n\n# Check for McAfee registry keys\nWriteToLogFile "Checking for McAfee Registry Keys."\n$registryPaths = "HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall", "HKLM:\\Software\\WOW6432NODE\\Microsoft\\Windows\\CurrentVersion\\Uninstall"\n$searchInstalledSoftware = Get-ChildItem $registryPaths | ForEach-Object { $_.GetValue(\'DisplayName\') } | Where-Object { $_ -like \'*McAfee*\' }\n\n# If McAfee registry keys are found, remove McAfee\nif ($searchInstalledSoftware.Count -ne 0) {\n\n    WriteToLogFile "McAfee Keys found: $($searchInstalledSoftware)"\n\n    # Run the McAfee Cleanup Tool\n    WriteToLogFile "Running the removal tool."\n    $killMcafee = Start-Process .\\MCPR-Tool\\mccleanup.exe -ArgumentList "-p StopServices,MFSY,PEF,MXD,CSP,Sustainability,MOCP,MFP,APPSTATS,Auth,EMproxy,FWdiver,HW,MAS,MAT,MBK,MCPR,McProxy,McSvcHost,VUL,MHN,MNA,MOBK,MPFP,MPFPCU,MPS,SHRED,MPSCU,MQC,MQCCU,MSAD,MSHR,MSK,MSKCU,MWL,NMC,RedirSvc,VS,REMEDIATION,MSC,YAP,TRUEKEY,LAM,PCB,Symlink,SafeConnect,MGS,WMIRemover,RESIDUE -v -s"\n    WriteToLogFile "Cleanup tool has been launched. Machine will require reboot to complete."\n\n    # Delete McAfee shortcut icon.\n    try {\n        if(Test-Path \'C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\McAfee\'){\n            WriteToLogFile "Deleting Start Menu item"\n            Remove-Item \'C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\McAfee\'\n        }\n    }\n    catch{\n        WriteToLogFile "Error deleting Start Menu Items."\n        WriteToLogFile $_\n    }\n    \n    # Place text file at a location for Intune to detect.\n    WriteToLogFile "Creating detection text file here, C:\\ProgramData\\Output\\McAfee\\McAfee-Script-Ran-Successfully.txt"\n    New-Item -Path  "C:\\ProgramData\\Output\\McAfee" -Name "McAfee-Script-Ran-Successfully.txt"  -ItemType File \n}\nelse {\n\n    WriteToLogFile "No reference to McAfee Found."\n    WriteToLogFile "Terminating script."\n\n    # Place text file at a location for Intune to detect this result (add detection rule on win32 app for this).\n    WriteToLogFile "Creating detection text file here, C:\\ProgramData\\Output\\McAfee\\McAfee-Script-Ran-Successfully-McAfee-Not-Found.txt"\n    New-Item -Path  "C:\\ProgramData\\Output\\McAfee" -Name "McAfee-Script-Ran-Successfully-McAfee-Not-Found.txt"  -ItemType File\n}\n')))}d.isMDXComponent=!0}}]);