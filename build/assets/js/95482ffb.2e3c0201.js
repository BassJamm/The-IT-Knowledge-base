"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4890],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},m="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=u(n),c=o,d=m["".concat(l,".").concat(c)]||m[c]||h[c]||a;return n?i.createElement(d,r(r({ref:t},p),{},{components:n})):i.createElement(d,r({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:o,r[1]=s;for(var u=2;u<a;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},460:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var i=n(7462),o=(n(7294),n(3905));const a={draft:!1,title:"Azure ligthhouse Setup",description:"The lesssons I have learned setting up Azure Ligthouse.",slug:"Setup-Azure-Lighthouse",date:"2023-10-21T13:00",toc_max_heading_level:5,authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],tags:["Azure","Lighthouse"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},r=void 0,s={permalink:"/blog/Setup-Azure-Lighthouse",source:"@site/blog/2023-10-21-Setup-Lighthouse/Setup-AzureLighthouse.md",title:"Azure ligthhouse Setup",description:"The lesssons I have learned setting up Azure Ligthouse.",date:"2023-10-21T13:00:00.000Z",formattedDate:"October 21, 2023",tags:[{label:"Azure",permalink:"/blog/tags/azure"},{label:"Lighthouse",permalink:"/blog/tags/lighthouse"}],readingTime:4.836666666666667,hasTruncateMarker:!0,authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],frontMatter:{draft:!1,title:"Azure ligthhouse Setup",description:"The lesssons I have learned setting up Azure Ligthouse.",slug:"Setup-Azure-Lighthouse",date:"2023-10-21T13:00",toc_max_heading_level:5,authors:[{name:"Will",title:"Creator of the IT KB.",url:"https://github.com/BassJamm?tab=repositories"}],tags:["Azure","Lighthouse"],image:"https://i.imgur.com/mErPwqL.png",hide_table_of_contents:!1},nextItem:{title:"Challenge 2 - Folder Size Report with PowerShell",permalink:"/blog/pwsh-challenge-002"}},l={authorsImageUrls:[void 0]},u=[{value:"Online Reading",id:"online-reading",level:2},{value:"Setup Guidance",id:"setup-guidance",level:2},{value:"Azure AD",id:"azure-ad",level:3},{value:"Azure Lighthouse Offering",id:"azure-lighthouse-offering",level:3},{value:"ARM Template",id:"arm-template",level:4},{value:"Offering Name",id:"offering-name",level:5},{value:"Description(s)",id:"descriptions",level:5},{value:"Delegation Scope(s)",id:"delegation-scopes",level:5},{value:"Authorisations",id:"authorisations",level:5},{value:"ARM template Example",id:"arm-template-example",level:3},{value:"Using Lighthouse",id:"using-lighthouse",level:2},{value:"Via the Lighthouse blade",id:"via-the-lighthouse-blade",level:3},{value:"Via the subscriptions blade",id:"via-the-subscriptions-blade",level:3},{value:"Partner Earned Credit (PEC) using PAL",id:"partner-earned-credit-pec-using-pal",level:2}],p={toc:u},m="wrapper";function h(e){let{components:t,...n}=e;return(0,o.kt)(m,(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In this post, are the lessons learned when I first setup Azure Lighthouse as well as things I have picked up over the course of my year of using/supporting it within the company I work for."),(0,o.kt)("p",null,"Azure Lighthouse serves as a central command hub for businesses and service providers in the Azure cloud. It simplifies the management of various Azure accounts, making it a breeze to oversee resources and services while boosting security and efficiency. Think of it as your go-to control center for all things Azure."),(0,o.kt)("h2",{id:"online-reading"},"Online Reading"),(0,o.kt)("p",null,"Below are some links that are good reading before you dig into setting up the application."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/lighthouse/overview"},"Microsoft doc - What is Azure Lighthouse?"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/lighthouse/how-to/onboard-customer"},"Microsoft doc - Onboard a customer to Azure Lighthouse"),".")),(0,o.kt)("h2",{id:"setup-guidance"},"Setup Guidance"),(0,o.kt)("p",null,"You've got some key areas to think about here before you get started, Azure AD and your Azure Lighthouse offering/delegation. Before you get cracking think about the following:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"These are all explained further down!")),(0,o.kt)("p",null,"Azure Active Directory:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Are you going to create seperate groups per department."),(0,o.kt)("li",{parentName:"ul"},"What is your naming convention going to be.")),(0,o.kt)("p",null,"Azure Lighthouse offering/delegation:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Offering Naming Convention (Client will see this)."),(0,o.kt)("li",{parentName:"ul"},"Offering Description (Client will see this)."),(0,o.kt)("li",{parentName:"ul"},"Authorisations."),(0,o.kt)("li",{parentName:"ul"},"Delegation Scopes (Subscription level or Resource Group Leve.)")),(0,o.kt)("admonition",{title:"My Opinions",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"I'd highly recommend reviewing the links mentioned in the Online Reading section for up to date information. The information following this point are from my notes.")),(0,o.kt)("h3",{id:"azure-ad"},"Azure AD"),(0,o.kt)("p",null,"To set things up, start by creating some groups within Azure AD. These groups will include the satff members who need access to the customer/client through Azure lighthouse. You have the flexibility to make these groups as detailed and numerous as needed."),(0,o.kt)("p",null,"I recommend considering two key roles, these roles can be fine-tuned to meet your specific requirements:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Azure Lighthouse Contributor")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Azure Lighthouse Reader"))),(0,o.kt)("admonition",{title:"Role Assignment to staff business roles.",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Initially, I attempted to set up separate groups for each department, such as Operations, Service Desk, and Finance. While this approach worked well for the technical teams, it didn't meet my expectations when it came to granting access to billing information for the Finance team. After extensive testing, I discovered that using direct or named accounts, or leveraging the Microsoft Partner Center, provided a more effective solution.")),(0,o.kt)("h3",{id:"azure-lighthouse-offering"},"Azure Lighthouse Offering"),(0,o.kt)("h4",{id:"arm-template"},"ARM Template"),(0,o.kt)("p",null,"Below is an outline and suggestion for each relevant configurable options for the ARM template."),(0,o.kt)("admonition",{title:"On-boarding multiple Subscriptions or Resource Groups for one client\\customer.",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"You have the option to delegate multiple resource groups and subscriptions all at once from the Service Providers dashboard within the customer's tenant. While the documentation might imply otherwise, it is indeed possible and functional.")),(0,o.kt)("h5",{id:"offering-name"},"Offering Name"),(0,o.kt)("p",null,"When naming your offering, remember that it will be visible in your customer's tenant, so it's important that it looks good. I recommend using a format like this:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Managing Company Name")," Lighthouse Offering for ",(0,o.kt)("inlineCode",{parentName:"li"},"Customer Name")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Subscription or Resource Group Name"),".")),(0,o.kt)("p",null,"Be sure to replace the placeholders with the relevant details based on your naming convention."),(0,o.kt)("h5",{id:"descriptions"},"Description(s)"),(0,o.kt)("p",null,"The description is customer-facing, so it should be clear and informative. Here's a suggested format:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Managing Company Name")," managed services offer for overseeing supported resources."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Managing Company Name")," offer for managing and overseeing project resources for ",(0,o.kt)("inlineCode",{parentName:"li"},"project or PO number"),".")),(0,o.kt)("h5",{id:"delegation-scopes"},"Delegation Scope(s)"),(0,o.kt)("p",null,"You have two options: ",(0,o.kt)("inlineCode",{parentName:"p"},"Subscription")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Resource Group"),". These choices are quite self-explanatory. However, it's important to note that you cannot change these after deployment, so be sure to select the one that suits your specific needs."),(0,o.kt)("h5",{id:"authorisations"},"Authorisations"),(0,o.kt)("p",null,"Authorisations represent the roles you intend to assign to your pre-configured Azure AD groups. You have the flexibility to define these roles as either broad or specific, although I recommend a broader approach to minimize the need for creating or updating new delegations in the future."),(0,o.kt)("admonition",{title:"Broader Authorisations",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"While this approach may sound appealing in theory, it's crucial to think about security. It may not be advisable if you are responsible for managing a small portion or a specific resource within your customer's environment. Additionally, consider the nature of your customer in this context.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Principal type"),": Group"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Name"),": Choose one of the mentioned groups in the section above."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Display Name"),": Please do not edit. (This is the friendly name displayed in the customer's tenant, and it will default to the group name.)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Role"),": Assign the roles as indicated for the groups listed above."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Access Type"),": Permanent.")),(0,o.kt)("h3",{id:"arm-template-example"},"ARM template Example"),(0,o.kt)("p",null,"You can skip the initial lines until you locate ",(0,o.kt)("inlineCode",{parentName:"p"},"mspOfferName"),". In the vicinity of this, you'll find the description field. To make changes, modify the ",(0,o.kt)("inlineCode",{parentName:"p"},"defaultValue:")," data, not the ",(0,o.kt)("inlineCode",{parentName:"p"},"description:")," information."),(0,o.kt)("admonition",{title:"Confirming your scope",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Locate the line ",(0,o.kt)("inlineCode",{parentName:"p"},'"$schema": "https://schema.management.azure.com/schemas/2019-08-01/subscriptionDeploymentTemplate.json#",')," and modify it to reflect either a subscription or resource deployment template, depending on your initial selection.")),(0,o.kt)("p",null,"Similar situation with the ",(0,o.kt)("inlineCode",{parentName:"p"},"mspOfferDescription:")," as well."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:"showLineNumbers",showLineNumbers:!0},'"mspOfferName": {\n   "type": "string",\n   "metadata": {\n    "description": "Specify a unique name for your offer"\n   },\n   "defaultValue": "My Company Lighthouse Contributor Offer for Customer Name - Subscription Name "\n  },\n\n  "mspOfferDescription": {\n   "type": "string",\n   "metadata": {\n    "description": "Name of the Managed Service Provider offering"\n   },\n   "defaultValue": "My Company managed services offer to administer support resources."\n  }\n')),(0,o.kt)("p",null,"Locate the ",(0,o.kt)("inlineCode",{parentName:"p"},"variables:")," section to define your group and the Azure role assignments."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'managedByTenantId"')," - is your tenant or partner tenant ID."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"authorizations":')," - Are you Azure Roles assignments."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"principalId"')," - Is your object in the managing tenant."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"roleDefinitionId"')," - Is the Azure AD role you've assigned. In the case below, it's ",(0,o.kt)("inlineCode",{parentName:"li"},"Contributor")," and the ",(0,o.kt)("inlineCode",{parentName:"li"},"Managed Services Registration assignment Delete")," roles."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"principalIdDisplayName"')," - Is your friendly Group name, this will show in your customer tenant, it does not need to match the group name in the managing tenant.")),(0,o.kt)("p",null,"You'll see some of the information repeated for each role you assign to the same object in the managing tenant."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:"showLineNumbers",showLineNumbers:!0},'"variables": {\n  "mspRegistrationName": "[guid(parameters(\'mspOfferName\'))]",\n  "mspAssignmentName": "[guid(parameters(\'mspOfferName\'))]",\n  "managedByTenantId": "Your tenant ID",\n  "authorizations": [\n   {\n    "principalId": "Your object in the managing tenant",\n    "roleDefinitionId": "Id-number-here",\n    "principalIdDisplayName": "Lighthouse Contributor"\n   },\n   {\n    "principalId": "Your object in the managing tenant",\n    "roleDefinitionId": "Id-number-here",\n    "principalIdDisplayName": "Lighthouse Contributor"\n   }\n  ]\n },\n')),(0,o.kt)("admonition",{title:"You can edit the JSON template directly!",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You don't need to always duck back into Azure Lighthouse to create the templates, you can just edit the JSON files if you're comfortable doing so.")),(0,o.kt)("h2",{id:"using-lighthouse"},"Using Lighthouse"),(0,o.kt)("p",null,"After setting up and assigning your Lighthouse delegations to your staff, there's no specific action required to access Azure Lighthouse. It's consistently available. Below, we provide two methods to verify the status of your delegations."),(0,o.kt)("h3",{id:"via-the-lighthouse-blade"},"Via the Lighthouse blade"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Open the ",(0,o.kt)("strong",{parentName:"li"},"Azure Management Portal"),"."),(0,o.kt)("li",{parentName:"ol"},"Search for ",(0,o.kt)("strong",{parentName:"li"},"Azure Lighthouse"),"."),(0,o.kt)("li",{parentName:"ol"},"Click on the ",(0,o.kt)("strong",{parentName:"li"},"Delegations")," option on the left-hand side, you may need to click manage my customers if you\u2019ve no connections."),(0,o.kt)("li",{parentName:"ol"},"You will then see your list of your customer\u2019s subscriptions that you have access to.")),(0,o.kt)("h3",{id:"via-the-subscriptions-blade"},"Via the subscriptions blade"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"You'll need to show the customer in the subscription filter first though.")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Open the ",(0,o.kt)("strong",{parentName:"li"},"Azure Management Portal"),"."),(0,o.kt)("li",{parentName:"ol"},"Navigate to the ",(0,o.kt)("strong",{parentName:"li"},"Subscriptions blade"),"."),(0,o.kt)("li",{parentName:"ol"},"The list of subscriptions will also list the customer subscriptions you have access too."),(0,o.kt)("li",{parentName:"ol"},"In the ",(0,o.kt)("strong",{parentName:"li"},"Azure portal"),", Select the ",(0,o.kt)("strong",{parentName:"li"},"Directory + subscriptions")," or ",(0,o.kt)("strong",{parentName:"li"},"Settings icon")," in the top right of the page."),(0,o.kt)("li",{parentName:"ol"},"In the Directories + subscriptions settings page, ensure that the ",(0,o.kt)("strong",{parentName:"li"},"Advanced filters toggle is turned off"),"."),(0,o.kt)("li",{parentName:"ol"},"In the Default subscription filter section, ",(0,o.kt)("strong",{parentName:"li"},"select the appropriate directory")," and subscription.")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If you have been granted access to one or more resource groups, rather than to an entire subscription, select the subscription to which that resource group belongs. You'll then work in the context of that subscription, but will only be able to access the designated resource group(s).")),(0,o.kt)("h2",{id:"partner-earned-credit-pec-using-pal"},"Partner Earned Credit (PEC) using PAL"),(0,o.kt)("p",null,"PAL (Partner Admin Link) is how a partner can be recognized by Microsoft for their work in Azure on-behalf-of their customer."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/lighthouse/how-to/partner-earned-credit#associate-your-partner-id-when-you-onboard-new-customers"},"Microsoft doc - Associate your partner ID when you onboard new customers vai Lighthouse"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/partner-center/link-partner-id-for-azure-performance-pal-dpor#link-to-a-partnerid-with-pal"},"Microsoft doc - Link a PartnerID with PAL or DPOR for PAL"))),(0,o.kt)("p",null,"To do this via Lighthouse, in a nutshell."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-authenticate-service-principal-powershell"},(0,o.kt)("strong",{parentName:"a"},"Create a service principal"))," user account in your managing tenant."),(0,o.kt)("li",{parentName:"ol"},"Using that service principal account, ",(0,o.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/link-partner-id#link-to-a-partner-id"},(0,o.kt)("strong",{parentName:"a"},"link to your Associated Partner ID"))," in your managing tenant."),(0,o.kt)("li",{parentName:"ol"},"Include at least one authorization which includes the service principal Account as a user with an Azure built-in role that is eligible for PEC.")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"This role must be granted as a permanent assignment, not as a just-in-time eligible authorization, in order for PEC to apply.")))}h.isMDXComponent=!0}}]);